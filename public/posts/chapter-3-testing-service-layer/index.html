<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/my-programming-journey/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=my-programming-journey/livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Chapter 3: Testing the Service Layer - Adding Confidence to Go Code | My Programming Journey Blog</title>
<meta name="keywords" content="golang, testing, clean-architecture, mocking, testify, unit-testing, tdd, service-layer, dependency-injection, learning-in-public">
<meta name="description" content="Time to add some confidence to my Go Todo app! After building the structure and file storage, I&rsquo;m diving deep into testing. Starting with the service layer, where business logic lives and external dependencies need to be tamed.
Repo/branch: https://github.com/macesz/todo-go/blob/firs-unit-test/services/todo/service_test.go
Why Start with Service Layer Tests? üéØ
The service layer is the perfect starting point for testing because it&rsquo;s where your business logic lives, isolated from external concerns:

Business logic isolation: Test core functionality without I/O complications
Fast feedback: No database calls, file operations, or network requests
Dependency control: Mock external services to test edge cases systematically
Design validation: Interfaces and dependency injection patterns prove their worth here

Think of it as testing the &ldquo;brain&rdquo; of your application without worrying about the &ldquo;hands and feet&rdquo; (I/O operations).">
<meta name="author" content="Your Name">
<link rel="canonical" href="http://localhost:1313/my-programming-journey/posts/chapter-3-testing-service-layer/">
<link crossorigin="anonymous" href="/my-programming-journey/assets/css/stylesheet.08f7d74f0ada0f975d29ae436285b61ed7a719d05f350cb888d00341642995a2.css" integrity="sha256-CPfXTwraD5ddKa5DYoW2HtenGdBfNQy4iNADQWQplaI=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/my-programming-journey/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/my-programming-journey/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/my-programming-journey/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/my-programming-journey/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/my-programming-journey/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/my-programming-journey/posts/chapter-3-testing-service-layer/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="http://localhost:1313/my-programming-journey/posts/chapter-3-testing-service-layer/">
  <meta property="og:site_name" content="My Programming Journey Blog">
  <meta property="og:title" content="Chapter 3: Testing the Service Layer - Adding Confidence to Go Code">
  <meta property="og:description" content="Time to add some confidence to my Go Todo app! After building the structure and file storage, I‚Äôm diving deep into testing. Starting with the service layer, where business logic lives and external dependencies need to be tamed.
Repo/branch: https://github.com/macesz/todo-go/blob/firs-unit-test/services/todo/service_test.go
Why Start with Service Layer Tests? üéØ The service layer is the perfect starting point for testing because it‚Äôs where your business logic lives, isolated from external concerns:
Business logic isolation: Test core functionality without I/O complications Fast feedback: No database calls, file operations, or network requests Dependency control: Mock external services to test edge cases systematically Design validation: Interfaces and dependency injection patterns prove their worth here Think of it as testing the ‚Äúbrain‚Äù of your application without worrying about the ‚Äúhands and feet‚Äù (I/O operations).">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-09-19T15:01:37+02:00">
    <meta property="article:modified_time" content="2025-09-19T15:01:37+02:00">
    <meta property="article:tag" content="Golang">
    <meta property="article:tag" content="Testing">
    <meta property="article:tag" content="Clean-Architecture">
    <meta property="article:tag" content="Mocking">
    <meta property="article:tag" content="Testify">
    <meta property="article:tag" content="Unit-Testing">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 3: Testing the Service Layer - Adding Confidence to Go Code">
<meta name="twitter:description" content="Time to add some confidence to my Go Todo app! After building the structure and file storage, I&rsquo;m diving deep into testing. Starting with the service layer, where business logic lives and external dependencies need to be tamed.
Repo/branch: https://github.com/macesz/todo-go/blob/firs-unit-test/services/todo/service_test.go
Why Start with Service Layer Tests? üéØ
The service layer is the perfect starting point for testing because it&rsquo;s where your business logic lives, isolated from external concerns:

Business logic isolation: Test core functionality without I/O complications
Fast feedback: No database calls, file operations, or network requests
Dependency control: Mock external services to test edge cases systematically
Design validation: Interfaces and dependency injection patterns prove their worth here

Think of it as testing the &ldquo;brain&rdquo; of your application without worrying about the &ldquo;hands and feet&rdquo; (I/O operations).">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/my-programming-journey/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Chapter 3: Testing the Service Layer - Adding Confidence to Go Code",
      "item": "http://localhost:1313/my-programming-journey/posts/chapter-3-testing-service-layer/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Chapter 3: Testing the Service Layer - Adding Confidence to Go Code",
  "name": "Chapter 3: Testing the Service Layer - Adding Confidence to Go Code",
  "description": "Time to add some confidence to my Go Todo app! After building the structure and file storage, I\u0026rsquo;m diving deep into testing. Starting with the service layer, where business logic lives and external dependencies need to be tamed.\nRepo/branch: https://github.com/macesz/todo-go/blob/firs-unit-test/services/todo/service_test.go\nWhy Start with Service Layer Tests? üéØ The service layer is the perfect starting point for testing because it\u0026rsquo;s where your business logic lives, isolated from external concerns:\nBusiness logic isolation: Test core functionality without I/O complications Fast feedback: No database calls, file operations, or network requests Dependency control: Mock external services to test edge cases systematically Design validation: Interfaces and dependency injection patterns prove their worth here Think of it as testing the \u0026ldquo;brain\u0026rdquo; of your application without worrying about the \u0026ldquo;hands and feet\u0026rdquo; (I/O operations).\n",
  "keywords": [
    "golang", "testing", "clean-architecture", "mocking", "testify", "unit-testing", "tdd", "service-layer", "dependency-injection", "learning-in-public"
  ],
  "articleBody": "Time to add some confidence to my Go Todo app! After building the structure and file storage, I‚Äôm diving deep into testing. Starting with the service layer, where business logic lives and external dependencies need to be tamed.\nRepo/branch: https://github.com/macesz/todo-go/blob/firs-unit-test/services/todo/service_test.go\nWhy Start with Service Layer Tests? üéØ The service layer is the perfect starting point for testing because it‚Äôs where your business logic lives, isolated from external concerns:\nBusiness logic isolation: Test core functionality without I/O complications Fast feedback: No database calls, file operations, or network requests Dependency control: Mock external services to test edge cases systematically Design validation: Interfaces and dependency injection patterns prove their worth here Think of it as testing the ‚Äúbrain‚Äù of your application without worrying about the ‚Äúhands and feet‚Äù (I/O operations).\nKey Testing Patterns I Learned üìö 1. Table-Driven Tests with initMocks Functions This pattern keeps test cases clean while allowing flexible mock behavior per scenario:\nfunc TestTodoService_Create(t *testing.T) { type args struct { ctx context.Context title string } tests := []struct { name string args args want domain.Todo wantErr bool initMocks func(t *testing.T, args *args, s *TodoService) }{ { name: \"successful creation\", args: args{ ctx: context.Background(), title: \"Learn Go testing\", }, want: domain.Todo{ ID: 1, Title: \"Learn Go testing\", Done: false, CreatedAt: time.Now(), }, wantErr: false, initMocks: func(t *testing.T, args *args, s *TodoService) { mockStore := mocks.NewTodoStore(t) mockStore.On(\"Create\", args.ctx, args.title).Return(expectedTodo, nil) s.Store = mockStore }, }, { name: \"empty title validation\", args: args{ ctx: context.Background(), title: \"\", }, wantErr: true, initMocks: func(t *testing.T, args *args, s *TodoService) { // No store calls expected for validation failures mockStore := mocks.NewTodoStore(t) s.Store = mockStore }, }, { name: \"store failure propagation\", args: args{ ctx: context.Background(), title: \"Valid title\", }, wantErr: true, initMocks: func(t *testing.T, args *args, s *TodoService) { mockStore := mocks.NewTodoStore(t) mockStore.On(\"Create\", args.ctx, args.title). Return(domain.Todo{}, errors.New(\"database connection failed\")) s.Store = mockStore }, }, } for _, tt := range tests { t.Run(tt.name, func(t *testing.T) { t.Parallel() // Run tests concurrently service := \u0026TodoService{} // Set up mocks for this specific test case if tt.initMocks != nil { tt.initMocks(t, \u0026tt.args, service) } got, err := service.Create(tt.args.ctx, tt.args.title) if tt.wantErr { assert.Error(t, err) return } assert.NoError(t, err) assert.Equal(t, tt.want.Title, got.Title) assert.Equal(t, tt.want.Done, got.Done) assert.False(t, got.CreatedAt.IsZero()) }) } } 2. The initMocks Pattern (My Favorite Discovery!) initMocks: func(t *testing.T, args *args, s *TodoService) { mockStore := mocks.NewTodoStore(t) mockStore.On(\"Create\", args.ctx, args.title).Return(expectedTodo, nil) s.Store = mockStore } This pattern is brilliant because it:\nKeeps the test table readable and focused Allows unique mock behavior per test case Makes it easy to set up complex mock interactions Separates test data from test setup logic 3. Fresh Mocks Per Test Using testify/mock with fresh instances prevents test contamination:\n// ‚úÖ Good: Fresh mock per test mockStore := mocks.NewTodoStore(t) // ‚ùå Bad: Shared mock across tests (state leaks!) var globalMockStore *mocks.TodoStore 4. Parallel Testing for Speed func TestTodoService_GetAll(t *testing.T) { // ... test cases ... for _, tt := range tests { t.Run(tt.name, func(t *testing.T) { t.Parallel() // üöÄ Run concurrently for faster execution // ... test logic ... }) } } What I‚Äôm Testing ‚úÖ CRUD Operations func TestTodoService_Create(t *testing.T) { /* ... */ } func TestTodoService_GetByID(t *testing.T) { /* ... */ } func TestTodoService_GetAll(t *testing.T) { /* ... */ } func TestTodoService_Update(t *testing.T) { /* ... */ } func TestTodoService_Delete(t *testing.T) { /* ... */ } Validation Logic // Testing business rules { name: \"empty title should fail\", args: args{title: \"\"}, wantErr: true, }, { name: \"whitespace-only title should fail\", args: args{title: \" \"}, wantErr: true, }, Error Propagation { name: \"store error should propagate\", initMocks: func(t *testing.T, args *args, s *TodoService) { mockStore := mocks.NewTodoStore(t) mockStore.On(\"GetByID\", args.ctx, args.id). Return(domain.Todo{}, errors.New(\"connection lost\")) s.Store = mockStore }, wantErr: true, }, Business Rules func TestTodoService_Complete(t *testing.T) { // Test: Can't complete already-done todos { name: \"already completed todo should fail\", args: args{id: 1}, initMocks: func(t *testing.T, args *args, s *TodoService) { mockStore := mocks.NewTodoStore(t) alreadyDone := domain.Todo{ID: 1, Done: true} mockStore.On(\"GetByID\", args.ctx, args.id).Return(alreadyDone, nil) s.Store = mockStore }, wantErr: true, }, } Context Handling func TestTodoService_CreateWithTimeout(t *testing.T) { ctx, cancel := context.WithTimeout(context.Background(), 1*time.Millisecond) defer cancel() time.Sleep(2 * time.Millisecond) // Force timeout service := \u0026TodoService{Store: mockStore} _, err := service.Create(ctx, \"Test todo\") assert.Error(t, err) assert.Contains(t, err.Error(), \"context deadline exceeded\") } Why Mock Dependencies? üé≠ The service layer should focus on business logic, not I/O details. Mocking the TodoStore interface lets me:\nSimulate Failures Without Real Systems // Test database connection failures without a database mockStore.On(\"Create\", mock.Anything, mock.Anything). Return(domain.Todo{}, errors.New(\"connection refused\")) Test Edge Cases Systematically // Test concurrent access scenarios mockStore.On(\"GetByID\", mock.Anything, 1). Return(domain.Todo{}, errors.New(\"resource locked\")). Once() Keep Tests Fast and Deterministic No I/O operations = tests run in milliseconds No external dependencies = tests never fail due to network issues Predictable responses = tests are completely deterministic Verify Interface Usage // Verify the service calls store methods correctly mockStore.AssertExpectations(t) mockStore.AssertCalled(t, \"Create\", context.Background(), \"Test todo\") Testing Tools Stack üõ†Ô∏è Core Testing import ( \"testing\" \"github.com/stretchr/testify/assert\" \"github.com/stretchr/testify/mock\" ) Mock Generation # Install mockery for generating mocks from interfaces go install github.com/vektra/mockery/v2@latest # Generate mocks mockery --name=TodoStore --dir=domain --output=mocks Generated Mock Usage // mocks/TodoStore.go (auto-generated) type TodoStore struct { mock.Mock } func (m *TodoStore) Create(ctx context.Context, title string) (domain.Todo, error) { ret := m.Called(ctx, title) return ret.Get(0).(domain.Todo), ret.Error(1) } Real-World Test Examples üí° Testing Validation Logic func TestTodoService_ValidateTitle(t *testing.T) { tests := []struct { name string title string wantErr bool errMsg string }{ {\"valid title\", \"Learn Go\", false, \"\"}, {\"empty title\", \"\", true, \"title cannot be empty\"}, {\"whitespace only\", \" \", true, \"title cannot be empty\"}, {\"too long title\", strings.Repeat(\"a\", 256), true, \"title too long\"}, } for _, tt := range tests { t.Run(tt.name, func(t *testing.T) { service := \u0026TodoService{} err := service.validateTitle(tt.title) if tt.wantErr { assert.Error(t, err) assert.Contains(t, err.Error(), tt.errMsg) } else { assert.NoError(t, err) } }) } } Testing Concurrent Operations func TestTodoService_ConcurrentCreates(t *testing.T) { mockStore := mocks.NewTodoStore(t) service := \u0026TodoService{Store: mockStore} // Set up mock to handle multiple concurrent calls mockStore.On(\"Create\", mock.Anything, mock.AnythingOfType(\"string\")). Return(domain.Todo{ID: 1, Title: \"test\"}, nil). Times(10) // Expect exactly 10 calls var wg sync.WaitGroup errChan := make(chan error, 10) // Start 10 concurrent creates for i := 0; i \u003c 10; i++ { wg.Add(1) go func(i int) { defer wg.Done() _, err := service.Create(context.Background(), fmt.Sprintf(\"Todo %d\", i)) errChan \u003c- err }(i) } wg.Wait() close(errChan) // Verify no errors occurred for err := range errChan { assert.NoError(t, err) } mockStore.AssertExpectations(t) } Running the Tests üèÉ‚Äç‚ôÇÔ∏è # Run all tests go test ./... # Run with coverage go test -cover ./... # Run with detailed output go test -v ./... # Run specific test go test -run TestTodoService_Create ./service # Run tests in parallel with race detection go test -race -parallel 4 ./... # Benchmark performance go test -bench=. ./... Test Coverage Report üìä # Generate HTML coverage report go test -coverprofile=coverage.out ./... go tool cover -html=coverage.out -o coverage.html open coverage.html Current coverage for service layer: 94% üéØ\nMissing coverage:\nError handling in edge cases (working on it!) Some validation branches (adding more test cases) Lessons Learned üéì 1. Interfaces Enable Testability The TodoStore interface makes mocking trivial. Without it, testing would require real databases or complex setup.\n2. Table-Driven Tests Scale Well As I add more business logic, new test cases are just new entries in the table. The framework stays the same.\n3. Fresh Mocks Prevent Weird Bugs I learned this the hard way when tests started failing mysteriously due to mock state leaking between tests.\n4. Context Propagation is Crucial Testing context cancellation and timeouts revealed bugs I wouldn‚Äôt have found otherwise.\n5. Error Messages Matter Testing that error messages are helpful made me write better error handling throughout the app.\nCommon Testing Gotchas I Hit üö® 1. Not Calling AssertExpectations // ‚ùå Forgot this - mocks not properly verified defer mockStore.AssertExpectations(t) 2. Sharing Mocks Between Tests // ‚ùå Bad: Shared state causes flaky tests var sharedMock *mocks.TodoStore // ‚úÖ Good: Fresh mock per test mockStore := mocks.NewTodoStore(t) 3. Not Testing Error Cases Initially focused on happy path. Error scenarios revealed important bugs!\n4. Forgetting t.Parallel() Tests run much faster when they can run concurrently.\nWhat‚Äôs Coming Up in This Testing Series üöÄ üîú Chapter 4: Storage Layer Tests Real file I/O testing Concurrency and race conditions Error recovery scenarios Performance benchmarks ‚è≠Ô∏è Chapter 5: HTTP Handler Tests JSON parsing and validation URL parameters and routing HTTP status codes and headers Request/response mocking üéØ Chapter 6: Integration Tests All layers working together End-to-end request flows Database integration testing Docker test containers üß™ Chapter 7: Advanced Testing Property-based testing Chaos engineering principles Load testing strategies Test data management Why This Matters üí° The dependency injection design from Chapter 1 is paying huge dividends now. Swapping real implementations for mocks is seamless, and the clean separation of concerns makes each layer easy to test in isolation.\nThis is exactly why we invest in good architecture upfront‚Äîit makes everything else (including testing) much easier down the road.\nPerformance Notes ‚ö° Service layer tests are incredibly fast because they avoid I/O:\n$ go test -v ./service === RUN TestTodoService_Create === PAUSE TestTodoService_Create === RUN TestTodoService_GetByID === PAUSE TestTodoService_GetByID === CONT TestTodoService_Create === CONT TestTodoService_GetByID --- PASS: TestTodoService_Create (0.00s) --- PASS: TestTodoService_GetByID (0.00s) PASS ok github.com/macesz/go-todo-chi/service 0.003s 3 milliseconds for a comprehensive test suite! This fast feedback loop makes TDD actually enjoyable.\nYour Turn! ü§ù Learning in public continues! I‚Äôd love to hear from the Go community:\nWhat testing patterns have helped you the most in Go? Any gotchas I should watch for as I expand this test suite? Favorite testing libraries or tools you‚Äôd recommend? Common mistakes you made early in your Go testing journey? Drop your thoughts in the comments‚Äîlet‚Äôs learn together!\nThis is Chapter 3 of my Go learning series. Follow along as I build from simple concepts to production-ready patterns, one layer at a time.\nNext up: Chapter 4 will tackle the storage layer, where we‚Äôll test real file I/O, handle concurrency safely, and ensure our data persistence is bulletproof.\n",
  "wordCount" : "1660",
  "inLanguage": "en",
  "datePublished": "2025-09-19T15:01:37+02:00",
  "dateModified": "2025-09-19T15:01:37+02:00",
  "author":{
    "@type": "Person",
    "name": "Your Name"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/my-programming-journey/posts/chapter-3-testing-service-layer/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "My Programming Journey Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/my-programming-journey/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/my-programming-journey/" accesskey="h" title="My Programming Journey Blog (Alt + H)">My Programming Journey Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/my-programming-journey/posts/" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/my-programming-journey/about/" title="About">
                    <span>About</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/my-programming-journey/">Home</a>&nbsp;¬ª&nbsp;<a href="http://localhost:1313/my-programming-journey/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Chapter 3: Testing the Service Layer - Adding Confidence to Go Code
      <span class="entry-hint" title="Draft">
        <svg xmlns="http://www.w3.org/2000/svg" height="35" viewBox="0 -960 960 960" fill="currentColor">
          <path
            d="M160-410v-60h300v60H160Zm0-165v-60h470v60H160Zm0-165v-60h470v60H160Zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22q0 11-4.5 22.5T862.09-380L643-160H520Zm300-263-37-37 37 37ZM580-220h38l121-122-18-19-19-18-122 121v38Zm141-141-19-18 37 37-18-19Z" />
        </svg>
      </span>
    </h1>
    <div class="post-meta"><span title='2025-09-19 15:01:37 +0200 CEST'>September 19, 2025</span>&nbsp;¬∑&nbsp;8 min&nbsp;¬∑&nbsp;1660 words&nbsp;¬∑&nbsp;Your Name

</div>
  </header> 
  <div class="post-content"><p>Time to add some confidence to my Go Todo app! After building the structure and file storage, I&rsquo;m diving deep into testing. Starting with the service layer, where business logic lives and external dependencies need to be tamed.</p>
<p><strong>Repo/branch</strong>: <a href="https://github.com/macesz/todo-go/blob/firs-unit-test/services/todo/service_test.go">https://github.com/macesz/todo-go/blob/firs-unit-test/services/todo/service_test.go</a></p>
<h2 id="why-start-with-service-layer-tests-">Why Start with Service Layer Tests? üéØ<a hidden class="anchor" aria-hidden="true" href="#why-start-with-service-layer-tests-">#</a></h2>
<p>The service layer is the perfect starting point for testing because it&rsquo;s where your business logic lives, isolated from external concerns:</p>
<ul>
<li><strong>Business logic isolation</strong>: Test core functionality without I/O complications</li>
<li><strong>Fast feedback</strong>: No database calls, file operations, or network requests</li>
<li><strong>Dependency control</strong>: Mock external services to test edge cases systematically</li>
<li><strong>Design validation</strong>: Interfaces and dependency injection patterns prove their worth here</li>
</ul>
<p>Think of it as testing the &ldquo;brain&rdquo; of your application without worrying about the &ldquo;hands and feet&rdquo; (I/O operations).</p>
<h2 id="key-testing-patterns-i-learned-">Key Testing Patterns I Learned üìö<a hidden class="anchor" aria-hidden="true" href="#key-testing-patterns-i-learned-">#</a></h2>
<h3 id="1-table-driven-tests-with-initmocks-functions">1. Table-Driven Tests with <code>initMocks</code> Functions<a hidden class="anchor" aria-hidden="true" href="#1-table-driven-tests-with-initmocks-functions">#</a></h3>
<p>This pattern keeps test cases clean while allowing flexible mock behavior per scenario:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">TestTodoService_Create</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">args</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">ctx</span>   <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">title</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">tests</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">name</span>      <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">args</span>      <span style="color:#a6e22e">args</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">want</span>      <span style="color:#a6e22e">domain</span>.<span style="color:#a6e22e">Todo</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">wantErr</span>   <span style="color:#66d9ef">bool</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">initMocks</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>, <span style="color:#a6e22e">args</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">args</span>, <span style="color:#a6e22e">s</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">TodoService</span>)
</span></span><span style="display:flex;"><span>    }{
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">name</span>: <span style="color:#e6db74">&#34;successful creation&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">args</span>: <span style="color:#a6e22e">args</span>{
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">ctx</span>:   <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(),
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">title</span>: <span style="color:#e6db74">&#34;Learn Go testing&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">want</span>: <span style="color:#a6e22e">domain</span>.<span style="color:#a6e22e">Todo</span>{
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">ID</span>:        <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">Title</span>:     <span style="color:#e6db74">&#34;Learn Go testing&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">Done</span>:      <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">CreatedAt</span>: <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>(),
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">wantErr</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">initMocks</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>, <span style="color:#a6e22e">args</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">args</span>, <span style="color:#a6e22e">s</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">TodoService</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">mockStore</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">mocks</span>.<span style="color:#a6e22e">NewTodoStore</span>(<span style="color:#a6e22e">t</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">mockStore</span>.<span style="color:#a6e22e">On</span>(<span style="color:#e6db74">&#34;Create&#34;</span>, <span style="color:#a6e22e">args</span>.<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">args</span>.<span style="color:#a6e22e">title</span>).<span style="color:#a6e22e">Return</span>(<span style="color:#a6e22e">expectedTodo</span>, <span style="color:#66d9ef">nil</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">Store</span> = <span style="color:#a6e22e">mockStore</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">name</span>: <span style="color:#e6db74">&#34;empty title validation&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">args</span>: <span style="color:#a6e22e">args</span>{
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">ctx</span>:   <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(),
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">title</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">wantErr</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">initMocks</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>, <span style="color:#a6e22e">args</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">args</span>, <span style="color:#a6e22e">s</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">TodoService</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// No store calls expected for validation failures</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">mockStore</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">mocks</span>.<span style="color:#a6e22e">NewTodoStore</span>(<span style="color:#a6e22e">t</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">Store</span> = <span style="color:#a6e22e">mockStore</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">name</span>: <span style="color:#e6db74">&#34;store failure propagation&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">args</span>: <span style="color:#a6e22e">args</span>{
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">ctx</span>:   <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(),
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">title</span>: <span style="color:#e6db74">&#34;Valid title&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">wantErr</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">initMocks</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>, <span style="color:#a6e22e">args</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">args</span>, <span style="color:#a6e22e">s</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">TodoService</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">mockStore</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">mocks</span>.<span style="color:#a6e22e">NewTodoStore</span>(<span style="color:#a6e22e">t</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">mockStore</span>.<span style="color:#a6e22e">On</span>(<span style="color:#e6db74">&#34;Create&#34;</span>, <span style="color:#a6e22e">args</span>.<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">args</span>.<span style="color:#a6e22e">title</span>).
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">Return</span>(<span style="color:#a6e22e">domain</span>.<span style="color:#a6e22e">Todo</span>{}, <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;database connection failed&#34;</span>))
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">Store</span> = <span style="color:#a6e22e">mockStore</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">tt</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">tests</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">name</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Parallel</span>() <span style="color:#75715e">// Run tests concurrently</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">service</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">TodoService</span>{}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Set up mocks for this specific test case</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">initMocks</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">initMocks</span>(<span style="color:#a6e22e">t</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">args</span>, <span style="color:#a6e22e">service</span>)
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">got</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">service</span>.<span style="color:#a6e22e">Create</span>(<span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">args</span>.<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">args</span>.<span style="color:#a6e22e">title</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">wantErr</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Error</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">NoError</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Equal</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">want</span>.<span style="color:#a6e22e">Title</span>, <span style="color:#a6e22e">got</span>.<span style="color:#a6e22e">Title</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Equal</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">want</span>.<span style="color:#a6e22e">Done</span>, <span style="color:#a6e22e">got</span>.<span style="color:#a6e22e">Done</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">False</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">got</span>.<span style="color:#a6e22e">CreatedAt</span>.<span style="color:#a6e22e">IsZero</span>())
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="2-the-initmocks-pattern-my-favorite-discovery">2. The <code>initMocks</code> Pattern (My Favorite Discovery!)<a hidden class="anchor" aria-hidden="true" href="#2-the-initmocks-pattern-my-favorite-discovery">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">initMocks</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>, <span style="color:#a6e22e">args</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">args</span>, <span style="color:#a6e22e">s</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">TodoService</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mockStore</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">mocks</span>.<span style="color:#a6e22e">NewTodoStore</span>(<span style="color:#a6e22e">t</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mockStore</span>.<span style="color:#a6e22e">On</span>(<span style="color:#e6db74">&#34;Create&#34;</span>, <span style="color:#a6e22e">args</span>.<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">args</span>.<span style="color:#a6e22e">title</span>).<span style="color:#a6e22e">Return</span>(<span style="color:#a6e22e">expectedTodo</span>, <span style="color:#66d9ef">nil</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">Store</span> = <span style="color:#a6e22e">mockStore</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This pattern is <strong>brilliant</strong> because it:</p>
<ul>
<li>Keeps the test table readable and focused</li>
<li>Allows unique mock behavior per test case</li>
<li>Makes it easy to set up complex mock interactions</li>
<li>Separates test data from test setup logic</li>
</ul>
<h3 id="3-fresh-mocks-per-test">3. Fresh Mocks Per Test<a hidden class="anchor" aria-hidden="true" href="#3-fresh-mocks-per-test">#</a></h3>
<p>Using <code>testify/mock</code> with fresh instances prevents test contamination:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// ‚úÖ Good: Fresh mock per test</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mockStore</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">mocks</span>.<span style="color:#a6e22e">NewTodoStore</span>(<span style="color:#a6e22e">t</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ‚ùå Bad: Shared mock across tests (state leaks!)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">globalMockStore</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">mocks</span>.<span style="color:#a6e22e">TodoStore</span>
</span></span></code></pre></div><h3 id="4-parallel-testing-for-speed">4. Parallel Testing for Speed<a hidden class="anchor" aria-hidden="true" href="#4-parallel-testing-for-speed">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">TestTodoService_GetAll</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ... test cases ...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">tt</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">tests</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">name</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Parallel</span>() <span style="color:#75715e">// üöÄ Run concurrently for faster execution</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// ... test logic ...</span>
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="what-im-testing-">What I&rsquo;m Testing ‚úÖ<a hidden class="anchor" aria-hidden="true" href="#what-im-testing-">#</a></h2>
<h3 id="crud-operations">CRUD Operations<a hidden class="anchor" aria-hidden="true" href="#crud-operations">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">TestTodoService_Create</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) { <span style="color:#75715e">/* ... */</span> }
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">TestTodoService_GetByID</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) { <span style="color:#75715e">/* ... */</span> }
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">TestTodoService_GetAll</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) { <span style="color:#75715e">/* ... */</span> }
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">TestTodoService_Update</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) { <span style="color:#75715e">/* ... */</span> }
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">TestTodoService_Delete</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) { <span style="color:#75715e">/* ... */</span> }
</span></span></code></pre></div><h3 id="validation-logic">Validation Logic<a hidden class="anchor" aria-hidden="true" href="#validation-logic">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// Testing business rules</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">name</span>: <span style="color:#e6db74">&#34;empty title should fail&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">args</span>: <span style="color:#a6e22e">args</span>{<span style="color:#a6e22e">title</span>: <span style="color:#e6db74">&#34;&#34;</span>},
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">wantErr</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>},
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">name</span>: <span style="color:#e6db74">&#34;whitespace-only title should fail&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">args</span>: <span style="color:#a6e22e">args</span>{<span style="color:#a6e22e">title</span>: <span style="color:#e6db74">&#34;   &#34;</span>},
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">wantErr</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>},
</span></span></code></pre></div><h3 id="error-propagation">Error Propagation<a hidden class="anchor" aria-hidden="true" href="#error-propagation">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">name</span>: <span style="color:#e6db74">&#34;store error should propagate&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">initMocks</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>, <span style="color:#a6e22e">args</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">args</span>, <span style="color:#a6e22e">s</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">TodoService</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">mockStore</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">mocks</span>.<span style="color:#a6e22e">NewTodoStore</span>(<span style="color:#a6e22e">t</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">mockStore</span>.<span style="color:#a6e22e">On</span>(<span style="color:#e6db74">&#34;GetByID&#34;</span>, <span style="color:#a6e22e">args</span>.<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">args</span>.<span style="color:#a6e22e">id</span>).
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Return</span>(<span style="color:#a6e22e">domain</span>.<span style="color:#a6e22e">Todo</span>{}, <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;connection lost&#34;</span>))
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">Store</span> = <span style="color:#a6e22e">mockStore</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">wantErr</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>},
</span></span></code></pre></div><h3 id="business-rules">Business Rules<a hidden class="anchor" aria-hidden="true" href="#business-rules">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">TestTodoService_Complete</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Test: Can&#39;t complete already-done todos</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">name</span>: <span style="color:#e6db74">&#34;already completed todo should fail&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">args</span>: <span style="color:#a6e22e">args</span>{<span style="color:#a6e22e">id</span>: <span style="color:#ae81ff">1</span>},
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">initMocks</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>, <span style="color:#a6e22e">args</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">args</span>, <span style="color:#a6e22e">s</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">TodoService</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">mockStore</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">mocks</span>.<span style="color:#a6e22e">NewTodoStore</span>(<span style="color:#a6e22e">t</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">alreadyDone</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">domain</span>.<span style="color:#a6e22e">Todo</span>{<span style="color:#a6e22e">ID</span>: <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">Done</span>: <span style="color:#66d9ef">true</span>}
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">mockStore</span>.<span style="color:#a6e22e">On</span>(<span style="color:#e6db74">&#34;GetByID&#34;</span>, <span style="color:#a6e22e">args</span>.<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">args</span>.<span style="color:#a6e22e">id</span>).<span style="color:#a6e22e">Return</span>(<span style="color:#a6e22e">alreadyDone</span>, <span style="color:#66d9ef">nil</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">Store</span> = <span style="color:#a6e22e">mockStore</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">wantErr</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="context-handling">Context Handling<a hidden class="anchor" aria-hidden="true" href="#context-handling">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">TestTodoService_CreateWithTimeout</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">cancel</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">WithTimeout</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(), <span style="color:#ae81ff">1</span><span style="color:#f92672">*</span><span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Millisecond</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">cancel</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Millisecond</span>) <span style="color:#75715e">// Force timeout</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">service</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">TodoService</span>{<span style="color:#a6e22e">Store</span>: <span style="color:#a6e22e">mockStore</span>}
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">service</span>.<span style="color:#a6e22e">Create</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#e6db74">&#34;Test todo&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Error</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Contains</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>(), <span style="color:#e6db74">&#34;context deadline exceeded&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="why-mock-dependencies-">Why Mock Dependencies? üé≠<a hidden class="anchor" aria-hidden="true" href="#why-mock-dependencies-">#</a></h2>
<p>The service layer should focus on <strong>business logic</strong>, not I/O details. Mocking the <code>TodoStore</code> interface lets me:</p>
<h3 id="simulate-failures-without-real-systems">Simulate Failures Without Real Systems<a hidden class="anchor" aria-hidden="true" href="#simulate-failures-without-real-systems">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// Test database connection failures without a database</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mockStore</span>.<span style="color:#a6e22e">On</span>(<span style="color:#e6db74">&#34;Create&#34;</span>, <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">Anything</span>, <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">Anything</span>).
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Return</span>(<span style="color:#a6e22e">domain</span>.<span style="color:#a6e22e">Todo</span>{}, <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;connection refused&#34;</span>))
</span></span></code></pre></div><h3 id="test-edge-cases-systematically">Test Edge Cases Systematically<a hidden class="anchor" aria-hidden="true" href="#test-edge-cases-systematically">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// Test concurrent access scenarios</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mockStore</span>.<span style="color:#a6e22e">On</span>(<span style="color:#e6db74">&#34;GetByID&#34;</span>, <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">Anything</span>, <span style="color:#ae81ff">1</span>).
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Return</span>(<span style="color:#a6e22e">domain</span>.<span style="color:#a6e22e">Todo</span>{}, <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;resource locked&#34;</span>)).
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Once</span>()
</span></span></code></pre></div><h3 id="keep-tests-fast-and-deterministic">Keep Tests Fast and Deterministic<a hidden class="anchor" aria-hidden="true" href="#keep-tests-fast-and-deterministic">#</a></h3>
<ul>
<li><strong>No I/O operations</strong> = tests run in milliseconds</li>
<li><strong>No external dependencies</strong> = tests never fail due to network issues</li>
<li><strong>Predictable responses</strong> = tests are completely deterministic</li>
</ul>
<h3 id="verify-interface-usage">Verify Interface Usage<a hidden class="anchor" aria-hidden="true" href="#verify-interface-usage">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// Verify the service calls store methods correctly</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mockStore</span>.<span style="color:#a6e22e">AssertExpectations</span>(<span style="color:#a6e22e">t</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mockStore</span>.<span style="color:#a6e22e">AssertCalled</span>(<span style="color:#a6e22e">t</span>, <span style="color:#e6db74">&#34;Create&#34;</span>, <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(), <span style="color:#e6db74">&#34;Test todo&#34;</span>)
</span></span></code></pre></div><h2 id="testing-tools-stack-">Testing Tools Stack üõ†Ô∏è<a hidden class="anchor" aria-hidden="true" href="#testing-tools-stack-">#</a></h2>
<h3 id="core-testing">Core Testing<a hidden class="anchor" aria-hidden="true" href="#core-testing">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;testing&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;github.com/stretchr/testify/assert&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;github.com/stretchr/testify/mock&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><h3 id="mock-generation">Mock Generation<a hidden class="anchor" aria-hidden="true" href="#mock-generation">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Install mockery for generating mocks from interfaces</span>
</span></span><span style="display:flex;"><span>go install github.com/vektra/mockery/v2@latest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Generate mocks</span>
</span></span><span style="display:flex;"><span>mockery --name<span style="color:#f92672">=</span>TodoStore --dir<span style="color:#f92672">=</span>domain --output<span style="color:#f92672">=</span>mocks
</span></span></code></pre></div><h3 id="generated-mock-usage">Generated Mock Usage<a hidden class="anchor" aria-hidden="true" href="#generated-mock-usage">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// mocks/TodoStore.go (auto-generated)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">TodoStore</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">Mock</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">m</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">TodoStore</span>) <span style="color:#a6e22e">Create</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">title</span> <span style="color:#66d9ef">string</span>) (<span style="color:#a6e22e">domain</span>.<span style="color:#a6e22e">Todo</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ret</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">Called</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">title</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">ret</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#ae81ff">0</span>).(<span style="color:#a6e22e">domain</span>.<span style="color:#a6e22e">Todo</span>), <span style="color:#a6e22e">ret</span>.<span style="color:#a6e22e">Error</span>(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="real-world-test-examples-">Real-World Test Examples üí°<a hidden class="anchor" aria-hidden="true" href="#real-world-test-examples-">#</a></h2>
<h3 id="testing-validation-logic">Testing Validation Logic<a hidden class="anchor" aria-hidden="true" href="#testing-validation-logic">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">TestTodoService_ValidateTitle</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">tests</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">name</span>    <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">title</span>   <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">wantErr</span> <span style="color:#66d9ef">bool</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">errMsg</span>  <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    }{
</span></span><span style="display:flex;"><span>        {<span style="color:#e6db74">&#34;valid title&#34;</span>, <span style="color:#e6db74">&#34;Learn Go&#34;</span>, <span style="color:#66d9ef">false</span>, <span style="color:#e6db74">&#34;&#34;</span>},
</span></span><span style="display:flex;"><span>        {<span style="color:#e6db74">&#34;empty title&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#66d9ef">true</span>, <span style="color:#e6db74">&#34;title cannot be empty&#34;</span>},
</span></span><span style="display:flex;"><span>        {<span style="color:#e6db74">&#34;whitespace only&#34;</span>, <span style="color:#e6db74">&#34;   &#34;</span>, <span style="color:#66d9ef">true</span>, <span style="color:#e6db74">&#34;title cannot be empty&#34;</span>},
</span></span><span style="display:flex;"><span>        {<span style="color:#e6db74">&#34;too long title&#34;</span>, <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Repeat</span>(<span style="color:#e6db74">&#34;a&#34;</span>, <span style="color:#ae81ff">256</span>), <span style="color:#66d9ef">true</span>, <span style="color:#e6db74">&#34;title too long&#34;</span>},
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">tt</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">tests</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">name</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">service</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">TodoService</span>{}
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">service</span>.<span style="color:#a6e22e">validateTitle</span>(<span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">title</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">wantErr</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Error</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Contains</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>(), <span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">errMsg</span>)
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">NoError</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="testing-concurrent-operations">Testing Concurrent Operations<a hidden class="anchor" aria-hidden="true" href="#testing-concurrent-operations">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">TestTodoService_ConcurrentCreates</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mockStore</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">mocks</span>.<span style="color:#a6e22e">NewTodoStore</span>(<span style="color:#a6e22e">t</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">service</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">TodoService</span>{<span style="color:#a6e22e">Store</span>: <span style="color:#a6e22e">mockStore</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Set up mock to handle multiple concurrent calls</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mockStore</span>.<span style="color:#a6e22e">On</span>(<span style="color:#e6db74">&#34;Create&#34;</span>, <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">Anything</span>, <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">AnythingOfType</span>(<span style="color:#e6db74">&#34;string&#34;</span>)).
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Return</span>(<span style="color:#a6e22e">domain</span>.<span style="color:#a6e22e">Todo</span>{<span style="color:#a6e22e">ID</span>: <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">Title</span>: <span style="color:#e6db74">&#34;test&#34;</span>}, <span style="color:#66d9ef">nil</span>).
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Times</span>(<span style="color:#ae81ff">10</span>) <span style="color:#75715e">// Expect exactly 10 calls</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">wg</span> <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">WaitGroup</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">errChan</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">chan</span> <span style="color:#66d9ef">error</span>, <span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Start 10 concurrent creates</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">10</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">i</span> <span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Done</span>()
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">service</span>.<span style="color:#a6e22e">Create</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(), <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;Todo %d&#34;</span>, <span style="color:#a6e22e">i</span>))
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">errChan</span> <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>        }(<span style="color:#a6e22e">i</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Wait</span>()
</span></span><span style="display:flex;"><span>    close(<span style="color:#a6e22e">errChan</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Verify no errors occurred</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">errChan</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">NoError</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mockStore</span>.<span style="color:#a6e22e">AssertExpectations</span>(<span style="color:#a6e22e">t</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="running-the-tests-">Running the Tests üèÉ‚Äç‚ôÇÔ∏è<a hidden class="anchor" aria-hidden="true" href="#running-the-tests-">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Run all tests</span>
</span></span><span style="display:flex;"><span>go test ./...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Run with coverage</span>
</span></span><span style="display:flex;"><span>go test -cover ./...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Run with detailed output</span>
</span></span><span style="display:flex;"><span>go test -v ./...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Run specific test</span>
</span></span><span style="display:flex;"><span>go test -run TestTodoService_Create ./service
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Run tests in parallel with race detection</span>
</span></span><span style="display:flex;"><span>go test -race -parallel <span style="color:#ae81ff">4</span> ./...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Benchmark performance</span>
</span></span><span style="display:flex;"><span>go test -bench<span style="color:#f92672">=</span>. ./...
</span></span></code></pre></div><h2 id="test-coverage-report-">Test Coverage Report üìä<a hidden class="anchor" aria-hidden="true" href="#test-coverage-report-">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Generate HTML coverage report</span>
</span></span><span style="display:flex;"><span>go test -coverprofile<span style="color:#f92672">=</span>coverage.out ./...
</span></span><span style="display:flex;"><span>go tool cover -html<span style="color:#f92672">=</span>coverage.out -o coverage.html
</span></span><span style="display:flex;"><span>open coverage.html
</span></span></code></pre></div><p>Current coverage for service layer: <strong>94%</strong> üéØ</p>
<p>Missing coverage:</p>
<ul>
<li>Error handling in edge cases (working on it!)</li>
<li>Some validation branches (adding more test cases)</li>
</ul>
<h2 id="lessons-learned-">Lessons Learned üéì<a hidden class="anchor" aria-hidden="true" href="#lessons-learned-">#</a></h2>
<h3 id="1-interfaces-enable-testability">1. <strong>Interfaces Enable Testability</strong><a hidden class="anchor" aria-hidden="true" href="#1-interfaces-enable-testability">#</a></h3>
<p>The <code>TodoStore</code> interface makes mocking trivial. Without it, testing would require real databases or complex setup.</p>
<h3 id="2-table-driven-tests-scale-well">2. <strong>Table-Driven Tests Scale Well</strong><a hidden class="anchor" aria-hidden="true" href="#2-table-driven-tests-scale-well">#</a></h3>
<p>As I add more business logic, new test cases are just new entries in the table. The framework stays the same.</p>
<h3 id="3-fresh-mocks-prevent-weird-bugs">3. <strong>Fresh Mocks Prevent Weird Bugs</strong><a hidden class="anchor" aria-hidden="true" href="#3-fresh-mocks-prevent-weird-bugs">#</a></h3>
<p>I learned this the hard way when tests started failing mysteriously due to mock state leaking between tests.</p>
<h3 id="4-context-propagation-is-crucial">4. <strong>Context Propagation is Crucial</strong><a hidden class="anchor" aria-hidden="true" href="#4-context-propagation-is-crucial">#</a></h3>
<p>Testing context cancellation and timeouts revealed bugs I wouldn&rsquo;t have found otherwise.</p>
<h3 id="5-error-messages-matter">5. <strong>Error Messages Matter</strong><a hidden class="anchor" aria-hidden="true" href="#5-error-messages-matter">#</a></h3>
<p>Testing that error messages are helpful made me write better error handling throughout the app.</p>
<h2 id="common-testing-gotchas-i-hit-">Common Testing Gotchas I Hit üö®<a hidden class="anchor" aria-hidden="true" href="#common-testing-gotchas-i-hit-">#</a></h2>
<h3 id="1-not-calling">1. <strong>Not Calling <code>AssertExpectations</code></strong><a hidden class="anchor" aria-hidden="true" href="#1-not-calling">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// ‚ùå Forgot this - mocks not properly verified</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">mockStore</span>.<span style="color:#a6e22e">AssertExpectations</span>(<span style="color:#a6e22e">t</span>)
</span></span></code></pre></div><h3 id="2-sharing-mocks-between-tests">2. <strong>Sharing Mocks Between Tests</strong><a hidden class="anchor" aria-hidden="true" href="#2-sharing-mocks-between-tests">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// ‚ùå Bad: Shared state causes flaky tests</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">sharedMock</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">mocks</span>.<span style="color:#a6e22e">TodoStore</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ‚úÖ Good: Fresh mock per test</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mockStore</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">mocks</span>.<span style="color:#a6e22e">NewTodoStore</span>(<span style="color:#a6e22e">t</span>)
</span></span></code></pre></div><h3 id="3-not-testing-error-cases">3. <strong>Not Testing Error Cases</strong><a hidden class="anchor" aria-hidden="true" href="#3-not-testing-error-cases">#</a></h3>
<p>Initially focused on happy path. Error scenarios revealed important bugs!</p>
<h3 id="4-forgetting">4. <strong>Forgetting <code>t.Parallel()</code></strong><a hidden class="anchor" aria-hidden="true" href="#4-forgetting">#</a></h3>
<p>Tests run much faster when they can run concurrently.</p>
<h2 id="whats-coming-up-in-this-testing-series-">What&rsquo;s Coming Up in This Testing Series üöÄ<a hidden class="anchor" aria-hidden="true" href="#whats-coming-up-in-this-testing-series-">#</a></h2>
<h3 id="-chapter-4-storage-layer-tests">üîú <strong>Chapter 4: Storage Layer Tests</strong><a hidden class="anchor" aria-hidden="true" href="#-chapter-4-storage-layer-tests">#</a></h3>
<ul>
<li>Real file I/O testing</li>
<li>Concurrency and race conditions</li>
<li>Error recovery scenarios</li>
<li>Performance benchmarks</li>
</ul>
<h3 id="-chapter-5-http-handler-tests">‚è≠Ô∏è <strong>Chapter 5: HTTP Handler Tests</strong><a hidden class="anchor" aria-hidden="true" href="#-chapter-5-http-handler-tests">#</a></h3>
<ul>
<li>JSON parsing and validation</li>
<li>URL parameters and routing</li>
<li>HTTP status codes and headers</li>
<li>Request/response mocking</li>
</ul>
<h3 id="-chapter-6-integration-tests">üéØ <strong>Chapter 6: Integration Tests</strong><a hidden class="anchor" aria-hidden="true" href="#-chapter-6-integration-tests">#</a></h3>
<ul>
<li>All layers working together</li>
<li>End-to-end request flows</li>
<li>Database integration testing</li>
<li>Docker test containers</li>
</ul>
<h3 id="-chapter-7-advanced-testing">üß™ <strong>Chapter 7: Advanced Testing</strong><a hidden class="anchor" aria-hidden="true" href="#-chapter-7-advanced-testing">#</a></h3>
<ul>
<li>Property-based testing</li>
<li>Chaos engineering principles</li>
<li>Load testing strategies</li>
<li>Test data management</li>
</ul>
<h2 id="why-this-matters-">Why This Matters üí°<a hidden class="anchor" aria-hidden="true" href="#why-this-matters-">#</a></h2>
<p>The dependency injection design from Chapter 1 is <strong>paying huge dividends</strong> now. Swapping real implementations for mocks is seamless, and the clean separation of concerns makes each layer easy to test in isolation.</p>
<p>This is exactly why we invest in good architecture upfront‚Äîit makes everything else (including testing) much easier down the road.</p>
<h2 id="performance-notes-">Performance Notes ‚ö°<a hidden class="anchor" aria-hidden="true" href="#performance-notes-">#</a></h2>
<p>Service layer tests are incredibly fast because they avoid I/O:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ go test -v ./service
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> RUN   TestTodoService_Create
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> PAUSE TestTodoService_Create
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> RUN   TestTodoService_GetByID
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> PAUSE TestTodoService_GetByID
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> CONT  TestTodoService_Create
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> CONT  TestTodoService_GetByID
</span></span><span style="display:flex;"><span>--- PASS: TestTodoService_Create <span style="color:#f92672">(</span>0.00s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>--- PASS: TestTodoService_GetByID <span style="color:#f92672">(</span>0.00s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>PASS
</span></span><span style="display:flex;"><span>ok      github.com/macesz/go-todo-chi/service    0.003s
</span></span></code></pre></div><p><strong>3 milliseconds</strong> for a comprehensive test suite! This fast feedback loop makes TDD actually enjoyable.</p>
<h2 id="your-turn-">Your Turn! ü§ù<a hidden class="anchor" aria-hidden="true" href="#your-turn-">#</a></h2>
<p>Learning in public continues! I&rsquo;d love to hear from the Go community:</p>
<ul>
<li><strong>What testing patterns</strong> have helped you the most in Go?</li>
<li><strong>Any gotchas</strong> I should watch for as I expand this test suite?</li>
<li><strong>Favorite testing libraries</strong> or tools you&rsquo;d recommend?</li>
<li><strong>Common mistakes</strong> you made early in your Go testing journey?</li>
</ul>
<p>Drop your thoughts in the comments‚Äîlet&rsquo;s learn together!</p>
<hr>
<p><em>This is Chapter 3 of my Go learning series. Follow along as I build from simple concepts to production-ready patterns, one layer at a time.</em></p>
<p><strong>Next up</strong>: Chapter 4 will tackle the storage layer, where we&rsquo;ll test real file I/O, handle concurrency safely, and ensure our data persistence is bulletproof.</p>
<p><img alt="Go Gopher Testing" loading="lazy" src="/my-programming-journey/images/go-gopher-testing.png"></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/my-programming-journey/tags/golang/">Golang</a></li>
      <li><a href="http://localhost:1313/my-programming-journey/tags/testing/">Testing</a></li>
      <li><a href="http://localhost:1313/my-programming-journey/tags/clean-architecture/">Clean-Architecture</a></li>
      <li><a href="http://localhost:1313/my-programming-journey/tags/mocking/">Mocking</a></li>
      <li><a href="http://localhost:1313/my-programming-journey/tags/testify/">Testify</a></li>
      <li><a href="http://localhost:1313/my-programming-journey/tags/unit-testing/">Unit-Testing</a></li>
      <li><a href="http://localhost:1313/my-programming-journey/tags/tdd/">Tdd</a></li>
      <li><a href="http://localhost:1313/my-programming-journey/tags/service-layer/">Service-Layer</a></li>
      <li><a href="http://localhost:1313/my-programming-journey/tags/dependency-injection/">Dependency-Injection</a></li>
      <li><a href="http://localhost:1313/my-programming-journey/tags/learning-in-public/">Learning-in-Public</a></li>
    </ul>
<nav class="paginav">
  <a class="next" href="http://localhost:1313/my-programming-journey/posts/chapter-2-file-storage/">
    <span class="title">Next ¬ª</span>
    <br>
    <span>Chapter 2: From In-Memory to File Storage - Persistence Without Database Overhead üíæ</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Chapter 3: Testing the Service Layer - Adding Confidence to Go Code on x"
            href="https://x.com/intent/tweet/?text=Chapter%203%3a%20Testing%20the%20Service%20Layer%20-%20Adding%20Confidence%20to%20Go%20Code&amp;url=http%3a%2f%2flocalhost%3a1313%2fmy-programming-journey%2fposts%2fchapter-3-testing-service-layer%2f&amp;hashtags=golang%2ctesting%2cclean-architecture%2cmocking%2ctestify%2cunit-testing%2ctdd%2cservice-layer%2cdependency-injection%2clearning-in-public">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Chapter 3: Testing the Service Layer - Adding Confidence to Go Code on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fmy-programming-journey%2fposts%2fchapter-3-testing-service-layer%2f&amp;title=Chapter%203%3a%20Testing%20the%20Service%20Layer%20-%20Adding%20Confidence%20to%20Go%20Code&amp;summary=Chapter%203%3a%20Testing%20the%20Service%20Layer%20-%20Adding%20Confidence%20to%20Go%20Code&amp;source=http%3a%2f%2flocalhost%3a1313%2fmy-programming-journey%2fposts%2fchapter-3-testing-service-layer%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Chapter 3: Testing the Service Layer - Adding Confidence to Go Code on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fmy-programming-journey%2fposts%2fchapter-3-testing-service-layer%2f&title=Chapter%203%3a%20Testing%20the%20Service%20Layer%20-%20Adding%20Confidence%20to%20Go%20Code">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Chapter 3: Testing the Service Layer - Adding Confidence to Go Code on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fmy-programming-journey%2fposts%2fchapter-3-testing-service-layer%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Chapter 3: Testing the Service Layer - Adding Confidence to Go Code on whatsapp"
            href="https://api.whatsapp.com/send?text=Chapter%203%3a%20Testing%20the%20Service%20Layer%20-%20Adding%20Confidence%20to%20Go%20Code%20-%20http%3a%2f%2flocalhost%3a1313%2fmy-programming-journey%2fposts%2fchapter-3-testing-service-layer%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Chapter 3: Testing the Service Layer - Adding Confidence to Go Code on telegram"
            href="https://telegram.me/share/url?text=Chapter%203%3a%20Testing%20the%20Service%20Layer%20-%20Adding%20Confidence%20to%20Go%20Code&amp;url=http%3a%2f%2flocalhost%3a1313%2fmy-programming-journey%2fposts%2fchapter-3-testing-service-layer%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Chapter 3: Testing the Service Layer - Adding Confidence to Go Code on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Chapter%203%3a%20Testing%20the%20Service%20Layer%20-%20Adding%20Confidence%20to%20Go%20Code&u=http%3a%2f%2flocalhost%3a1313%2fmy-programming-journey%2fposts%2fchapter-3-testing-service-layer%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/my-programming-journey/">My Programming Journey Blog</a></span> ¬∑ 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
